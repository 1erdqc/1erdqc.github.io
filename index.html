<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Full Flip Clock + Weather</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400&display=swap" rel="stylesheet">
<style>
html, body {
    margin: 0; width: 100%; height: 100%;
    background: black; color: white;
    font-family: "Noto Sans", sans-serif;
    display: flex; justify-content: center; align-items: center;
    overflow: hidden;
}

#clock { display: flex; gap: 12px; }

.flip-digit {
    perspective: 1000px;
    width: 80px; height: 120px;
    position: relative;
}

.flip-card {
    width: 100%; height: 100%;
    position: absolute;
    transform-style: preserve-3d;
    transition: transform 0.5s ease-in-out;
}

.flip-card .front, .flip-card .back {
    position: absolute;
    width: 100%; height: 50%;
    overflow: hidden;
    backface-visibility: hidden;
    display: flex; justify-content: center; align-items: center;
    font-variant-numeric: tabular-nums;
}

.flip-card .front { 
    font-size: 64px; font-weight: 300;
    top: 0; border-bottom: 1px solid rgba(255,255,255,0.2);
}

.flip-card .back { 
    font-size: 64px; font-weight: 300;
    top: 50%; transform: rotateX(180deg);
    border-top: 1px solid rgba(255,255,255,0.2);
}

.separator {
    font-size: 64px; line-height: 120px;
    display: flex; align-items: center; justify-content: center;
}

/* Sol √ºst hava durumu */
#weather-info {
    position: fixed; top: 12px; left: 14px;
    font-size: 14px; line-height: 1.4;
    opacity: 0.9;
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.weather-line {
    display: flex;
    align-items: center;
    gap: 6px;
}
.weather-line span { white-space: nowrap; }

/* Saƒü √ºst cihaz info */
#device-info {
    position: fixed; top: 12px; right: 14px;
    font-size: 14px; line-height: 1.4;
    opacity: 0.65; text-align: right;
    font-variant-numeric: tabular-nums;
}
</style>
</head>
<body>

<div id="weather-info">Y√ºkleniyor‚Ä¶</div>
<div id="device-info"></div>
<div id="clock"></div>

<script>
// Flip clock
const clockEl = document.getElementById("clock");

function pad(n){ return n.toString().padStart(2,'0'); }

function createDigit(value) {
    const wrapper = document.createElement("div");
    wrapper.className = "flip-digit";
    wrapper.dataset.value = value;

    const card = document.createElement("div");
    card.className = "flip-card";

    const front = document.createElement("div");
    front.className = "front";
    front.textContent = value;

    const back = document.createElement("div");
    back.className = "back";
    back.textContent = value;

    card.appendChild(front);
    card.appendChild(back);
    wrapper.appendChild(card);
    return wrapper;
}

function updateDigit(wrapper, newValue) {
    const card = wrapper.querySelector(".flip-card");
    const front = wrapper.querySelector(".front");
    const back = wrapper.querySelector(".back");

    if(wrapper.dataset.value === newValue) return;

    back.textContent = newValue;
    card.style.transform = "rotateX(-180deg)";

    setTimeout(()=>{
        front.textContent = newValue;
        card.style.transform = "rotateX(0deg)";
        wrapper.dataset.value = newValue;
    },500);
}

function updateClock() {
    const now = new Date();
    const h = pad(now.getHours());
    const m = pad(now.getMinutes());
    const s = pad(now.getSeconds());

    const timeStr = h + m + s;

    if(clockEl.children.length === 0){
        for(let i=0;i<timeStr.length;i++){
            clockEl.appendChild(createDigit(timeStr[i]));
            if(i===1 || i===3){
                const sep = document.createElement("div");
                sep.className="separator"; sep.textContent=":";
                clockEl.appendChild(sep);
            }
        }
    } else {
        let digitIndex = 0;
        for(let i=0;i<clockEl.children.length;i++){
            const child = clockEl.children[i];
            if(child.classList.contains("flip-digit")){
                updateDigit(child,timeStr[digitIndex]);
                digitIndex++;
            }
        }
    }
}
setInterval(updateClock,1000);
updateClock();

// Cihaz + pil
const di = document.getElementById("device-info");
function setDeviceInfo(text, isLow=false) {
    di.textContent=text;
    di.style.color=isLow?"#ff4d4d":"rgba(255,255,255,0.65)";
}
function baseInfo(extra=""){
    return [navigator.platform||"Unknown",`${screen.width}√ó${screen.height}`,Intl.DateTimeFormat().resolvedOptions().timeZone,extra]
        .filter(Boolean).join(" ¬∑ ");
}
if(navigator.getBattery){
    navigator.getBattery().then(batt=>{
        function upd(){
            const p=Math.round(batt.level*100);
            setDeviceInfo(baseInfo(`${batt.charging?"‚ö°":"üîã"} ${p}%`), !batt.charging && p<15);
        }
        upd();
        batt.addEventListener("levelchange",upd);
        batt.addEventListener("chargingchange",upd);
    });
}else setDeviceInfo(baseInfo());

// üå§ Hava durumu
const wEl = document.getElementById("weather-info");
const LAT = 41.0602;
const LON = 28.9877;

function mapWeatherCode(code){
    const emojiMap = {
        0:"‚òÄÔ∏è",1:"üå§Ô∏è",2:"‚õÖ",3:"‚òÅÔ∏è",
        45:"üå´Ô∏è",48:"üå´Ô∏è",
        51:"üå¶Ô∏è",53:"üå¶Ô∏è",55:"üåßÔ∏è",
        61:"üåßÔ∏è",63:"üåßÔ∏è",65:"üåßÔ∏è",
        71:"‚ùÑÔ∏è",73:"‚ùÑÔ∏è",75:"‚ùÑÔ∏è",
        80:"üå¶Ô∏è",81:"üåßÔ∏è",82:"üåßÔ∏è",
        95:"‚õàÔ∏è",99:"‚õàÔ∏è"
    };
    return emojiMap[code] || "‚ùì";
}

function updateWeather(){
    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true&timezone=Europe/Istanbul`)
    .then(res=>res.json())
    .then(data=>{
        if(data.current_weather){
            const w = data.current_weather;
            const icon = mapWeatherCode(w.weathercode);
            const temp = Math.round(w.temperature);
            const wind = Math.round(w.windspeed);
            const apparent = Math.round(w.apparent_temperature || w.temperature);

            wEl.innerHTML = `
                <div class="weather-line"><span>${icon} ${temp}¬∞C</span></div>
                <div class="weather-line"><span>üí® R√ºzgar: ${wind} km/h</span></div>
                <div class="weather-line"><span>üå°Ô∏è Hissedilen: ${apparent}¬∞C</span></div>
            `;
        } else { wEl.textContent = "Hava verisi yok"; }
    })
    .catch(()=>{ wEl.textContent = "Hava y√ºklenemedi"; });
}
updateWeather();
setInterval(updateWeather,30*60*1000);
</script>

</body>
</html>
